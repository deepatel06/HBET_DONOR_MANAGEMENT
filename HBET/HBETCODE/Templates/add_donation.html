{% extends 'main.html' %} 

{% block title %} Add donation {% endblock title %} 

{% block Style %}
<style>
      form {
        max-width: 400px;
        height: 100%;
        margin: 0 auto;
        margin-right: 80px;
        margin-top: 10px;
        padding: 10px;
        border-style: solid;
        color: #ccc;
        border-radius: 5px;
        background: #fcfcfc;
        box-shadow: 8px 8px 16px #d1d1d1, -8px -8px 16px #ffffff;
      }
      label {
        margin-top: 7px;
        display: block;
        margin-bottom: 5px;
        margin-left: 5px;
        color: black;
      }
      input[type="text"],
      input[type="search"],
      input[type="email"],
      input[type="tel"],
      input[type="date"],
      select,
      textarea {
        width: 90%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-left: 5px;
      }
      input[type="submit"] {
        padding: 10px;
        background-color: #0322d3;
        color: #fff;
        border: none;
        width: 95%;
        border-radius: 5px;
        cursor: pointer;
        margin-left: 10px;
        margin-bottom: 5px;
      }
      input[type="submit"]:hover {
        background-color: #3b1d8d;
      }
      .art {
        margin-top: -50%;
        margin-left: 5px;
        height: 50%;
        width: 40%;
      }
      .art image {
        height: 50%;
        width: 40%;
      }
      form h1 {
        text-align: center;
        color: black;
      }
      .searchbox {
        position: absolute;
        margin-left: -350px;
        margin-top: -81px;
        padding: 10px;
        width: 20%;
        border-style: solid;
        color: #ccc;
        border-radius: 5px;
        background: #fcfcfc;
        box-shadow: 8px 8px 16px #d1d1d1, -8px -8px 16px #ffffff;
      }
      .addnewdonationtype {
        position: absolute;
        margin-left: -350px;
        margin-top: 170px;
        padding: 10px;
        width: 20%;
        border-style: solid;
        color: #ccc;
        border-radius: 5px;
        background: #fcfcfc;
        box-shadow: 8px 8px 16px #d1d1d1, -8px -8px 16px #ffffff;
      }
      .addnewdonationtype button {
        background-color: #0322d3;
        color: #fff;
        border-radius: 5px;
        width: 70%;
        height: 30px;
        align-items: center;
        margin-left: 30px;
      }
      .addnewdonationtype button:hover {
        background-color: #3b1d8d;
      }
  </style>
{% endblock Style %} 

{% block content %}
<div class="form-container">
  {% for message in messages %} <div class="animate__animated
  animate__bounceInUp" id="" style="color:#fff; background-color: #0322d3;
  width:25%; margin-top:4px; margin-left:290px; border-radius:30px;
  text-align:center; padding:10px; >
  <a class="close" href="#" data-dismiss="alert"></a>
  {{ message }}
</div>
{% endfor %}
<form class="rf" action="/insert_donation" method="post">
  {% csrf_token %}
  <h1>Donation Form</h1>
  <div class="searchbox">
    <h3 style="color: black; text-align: center">Search Existing Donor</h3>
    <label for="search">Search Donor:</label>
    <input
      type="search"
      id="search"
      oninput="handleSearch(event)"
      placeholder="Search for a Donor"
    />
    <br />
    <label for="userSelect">Select Donor:</label>
    <select id="userSelect" onchange="handleSelectChange(event)">
      <option value="" disabled selected>Select a user</option>
    </select>
  </div>
  <label for="firstname">Full Name:</label>
  <input type="text" id="firstname" name="firstname" required />
  <label for="phone">Contact No:</label>
  <input type="tel" id="phone" name="phone" required />
  <label for="donation_type">Type of Donation:</label>
  <select id="donation_type" name="donation_type" required>
    <option value="">-- Select Donation Type --</option>
    {% for value in donation_array %}
    <option value="{{ value }}">{{ value }}</option>
    {% endfor %}
    <!-- Add more options as needed -->
  </select>
  <label for="payment_type">Type of Payment:</label>
  <select id="payment_type" name="payment_type" required>
    <option value="">-- Select Payment Type --</option>
    <option value="Cash">Cash</option>
    <option value="Cheque">Cheque</option>
    <option value="UPI">UPI</option>
    <option value="NetBanking">Net Banking</option>
    <!-- Add more options as needed -->
  </select>
  <div id="cheque_fields" style="display: none">
    <label for="cheque_number">Cheque Number:</label>
    <input
      type="text"
      id="cheque_number"
      name="cheque_number"
      style="width: 90%; margin-left: 5px"
    />
    <label for="bank_name">Bank Name:</label>
    <input
      type="text"
      id="bank_name"
      name="bank_name"
      style="width: 90%; margin-left: 5px"
    />
  </div>
  <div id="transaction_fields" style="display: none">
    <label for="transaction_id">Transaction ID:</label>
    <input
      type="text"
      id="transaction_id"
      name="transaction_id"
      style="width: 90%; margin-left: 5px"
    />
  </div>
  <label for="amount">Amount in Rupees:</label>
  <input
    type="number"
    id="amount"
    name="amount"
    required
    style="
      width: 93%;
      border: 1px solid #ccc;
      border-radius: 5px;
      height: 30px;
      margin-left: 3px;
    "
  />
  <label for="dod">Date of Donation:</label>
  <input type="date" id="dod" name="dod" value="" />
  <label for="Remarks">Remarks:</label>
  <textarea id="Remarks" name="Remarks" rows="4"></textarea>
  <input type="submit" value="Submit" />
</form>
<div class="art">
  <img
    src="https://cdni.iconscout.com/illustration/premium/thumb/charity-and-donation-3142069-2621398.png"
    alt=""
  />
</div>
{% endblock content %} 

{% block script %}

<script>
  
var data = JSON.parse("{{donor_dict|escapejs}}")
console.log(data)

function handleSearch(event) {
    const searchTerm = event.target.value;
    const selectElement = document.getElementById("userSelect");
    selectElement.innerHTML = "";

    for (const name in data) {
        if (name.toLowerCase().includes(searchTerm.toLowerCase())) {
            const option = document.createElement("option");
            option.value = name;
            option.textContent = name;
            selectElement.appendChild(option);
        }
    }
}

function handleSelectChange(event) {
    const selectedName = event.target.value;
    const user = data[selectedName];
    document.getElementById("phone").value = user.contact_no;
    document.getElementById("firstname").value = user.name;

}

function handlePaymentTypeChange(event) {
    const selectedPaymentType = event.target.value;
    const chequeFields = document.getElementById("cheque_fields");
    const transactionFields = document.getElementById("transaction_fields");

    // Hide all fields initially
    chequeFields.style.display = "none";
    transactionFields.style.display = "none";

    if (selectedPaymentType === "Cheque") {
        chequeFields.style.display = "block";
    } else if (selectedPaymentType === "UPI" || selectedPaymentType === "NetBanking") {
        transactionFields.style.display = "block";
    }
}

// Add an event listener to the payment type select element
document.getElementById("payment_type").addEventListener("change", handlePaymentTypeChange);

document.getElementById("add_donation_type").addEventListener("click", function() {
    const newDonationType = document.getElementById("new_donation_type").value;
    if (newDonationType.trim() !== "") {
        const donationTypeDropdown = document.getElementById("donation_type");
        const newOption = document.createElement("option");
        newOption.value = newDonationType;
        newOption.textContent = newDonationType;
        donationTypeDropdown.appendChild(newOption);
        document.getElementById("new_donation_type").value = ""; // Clear the input field
    }
});
</script>
{% endblock script %}